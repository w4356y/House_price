---
background-image: url(http://img.univs.cn/webfile/event/279/4457082/272F7EF0-38F3-11E4-A154-F15F2C3DF0D0/1410358107229_4457082.jpg)
title: "南京房价调研"
subtitle: "新房"
author: "江伟"
institute: ""
date: "2020/05/21"
output:
  xaringan::moon_reader:
    css: [default, "custom.css", "zh-CN.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
background-image: url(http://img.univs.cn/webfile/event/279/4457082/272F7EF0-38F3-11E4-A154-F15F2C3DF0D0/1410358107229_4457082.jpg)

class: center, middle
# .title1[Overview]

.red[1\\. 房源分布/统计]

.red[2\\. 房价基本分析]

.red[3\\. 区域房价分析]

---
class: inverse, middle, center

## 房源分布/统计
.center[
.sub[总体分布]；

.sub[区域统计]；
]
---
class: inverse, middle, center

### 总体分布
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
class: left, top

### 总体分布
#### 房源区域分布

```{r set, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
#setwd("D:/HousePrice")
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)
library(knitr)
library(kableExtra)
source("../R/plot_func.R")
print("ok")
Sys.setlocale(category = "LC_ALL", locale = "chs")
```
```{r load, message=FALSE, warning = FALSE}
#setwd("D:/HousePrice")
## Read data from extracted data from lianjia
df_loupan = read_xlsx("../data/nanjing_xinloupan_2020-05-18.xlsx") %>% select(-c(1)) %>% distinct()
## Extract the min, max area and Total price
df_loupan <- df_loupan %>% mutate(Total_Price = str_replace(Total_Price,"\\s","")) %>%  mutate(Area_small = str_extract(Area,"建面\\d*"), Area_big = str_extract(Area, "-\\d*"), T_price = str_extract(Total_Price,"\\d+\\.*\\d*万"), Unit_price = str_extract(Total_Price, "^\\d*元")) %>% mutate(Area_small = str_replace(Area_small, "建面",""), Area_big = str_replace(Area_big,"-",""), T_price = str_replace_all(T_price, c("万" = ""," " = "")), Unit_price = str_replace_all(Unit_price,c("元" ="", "\\s" = "")))
## Get the house dietribution by district
df_loupan$District %>% table(dnn = "District") %>% as.data.frame() %>% arrange(desc(Freq)) %>% t()  %>% as.data.frame() %>% kable(.,format = 'markdown', col.names = NULL)
```

- .conclusion[江宁浦口房源最多，市场最热；]
- .conclusion[句容作为新兴市场，新房源增添较多；]
- .conclusion[玄武, 秦淮等市中心位置房源增加有限；]


---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 总体分布
#### 房源类型

- .conclusion[住宅在新房源中占比超过50%；]
.center[
```{r district_stat, echo=FALSE, fig.width= 7.5, fig.height=5}
## The distribution of house type
hist_pie(df_loupan$Type,scale = 0.7)
```
]
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 总体分布
#### 房屋状态
- .conclusion[!!新房源在售比例不超过55%，而售罄比例达到40%；]
.center[
```{r status_stat, echo=FALSE, fig.width= 7.5, fig.height=5}
## The distribution of house type
hist_pie(df_loupan$Status,scale = 0.7)
```
]
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 总体分布
#### 房屋总价
- .conclusion[!!超过30%的房价超过300万，50~150万接近30%，150~280万占比超过25%；]
.center[
```{r totalprice_stat, echo=FALSE, fig.width= 7.5, fig.height=5}
## The distribution of total price
filter(df_loupan, !is.na(T_price)) %>% pull(T_price) %>% str_replace_all(.,"\\s","") %>%  as.numeric() %>% cut(., breaks = c(0,50,100,150,200,240,280,300, 9000))  %>% hist_pie(., scale = 0.6)
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 总体分布
#### 房屋总价
- .conclusion[!!1.5~3万的均价占比约45%；]
.center[
```{r unitprice_stat, echo=FALSE, fig.width= 7.5, fig.height=5}
## The distribution of unit price
df_loupan$Unit_price[!is.na(df_loupan$Unit_price)] %>% as.numeric() %>% cut(., breaks = c(0,10000, 15000,20000, 25000,30000, 100000),na.rm = T) %>% hist_pie(.,scale = 0.5)
```
]
---
class: inverse, middle, center

### 区域统计

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 区域分布
#### 房源分布
- 房源区域分布
.center[
```{r district_stat1, echo=FALSE, fig.width= 7.5, fig.height=5, warning=FALSE,message=FALSE}
## Get the house dietribution by district
df_loupan$District %>% table(dnn = "District") %>% as.data.frame() %>% arrange(desc(Freq)) %>% t()  %>% as.data.frame() %>% kable(.,format = 'markdown', col.names = NULL)
```
]



- 街道区域分布
.center[
```{r  street_stat, echo=FALSE, fig.width= 7.5, fig.height=5, warning=FALSE, message=FALSE}

## Count the number of street in different district.
df_loupan %>% select(District, Street) %>% group_by(District) %>% dplyr::summarise(n_street = n_distinct(Street)) %>% arrange(desc(n_street)) %>% t() %>% as.data.frame() %>% kable(.,format = 'markdown', col.names = NULL)
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 区域分布
#### 房源类型/状态分布
.table1[
```{r group_stat, echo=FALSE, warning=FALSE, message=FALSE}
df_loupan %>% group_by(District) %>% summarise(数量 = n_distinct(Status),售罄 = sum(Status == "售罄"), 在售 = sum(Status == "在售"),未开盘 = sum(Status == "未开盘"),下期待开 = sum(Status == "下期待开"), 住宅 = sum(Type == "住宅"), 商业 = sum(Type == "商业"), 别墅 = sum(Type == "别墅"), 写字楼 = sum(Type == "写字楼"), 酒店式公寓=  sum(Type == "酒店式公寓")) %>% arrange(desc(数量)) %>% kable(.,format = 'html',row.names = FALSE, align = "c", longtable = TRUE) %>% kable_styling(full_width = T, font_size = 12) %>% add_header_above(header = c(" " = 2, "状态" = 4, "类型" = 5),font_size = 15 ,bold = T, italic = F, color = "green")
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 区域分布
#### 房源类型/状态分布
.table2[
```{r group_stat_render, echo=FALSE, warning=FALSE, eval=require('DT'), tidy=FALSE}
d1 = df_loupan %>% group_by(District) %>% summarise(数量 = n(),售罄 = sum(Status == "售罄"), 在售 = sum(Status == "在售"),未开盘 = sum(Status == "未开盘"),下期待开 = sum(Status == "下期待开"), 住宅 = sum(Type == "住宅"), 商业 = sum(Type == "商业"), 别墅 = sum(Type == "别墅"), 写字楼 = sum(Type == "写字楼"), 酒店式公寓=  sum(Type == "酒店式公寓")) %>% arrange(desc(数量)) 
DT::datatable(
  d1,
  fillContainer = FALSE, options = list(pageLength = 8)
)
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 区域分布
#### 区域单价分段统计
.table1[
```{r unit_price_type, echo=FALSE, warning=FALSE}
df_loupan %>%  filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% mutate(unit_price_type = cut(Unit_price, breaks = c(9999, 15000,20000, 22500,25000,27500,30000, 100000),na.rm = T, labels = c("1.0~1.5w","1.5~2.0w","2.0~2.25w","2.25~2.5w","2.5~2.75w","2.75~3.0w","3.0w+"))) %>% group_by(District) %>% summarise(数量 = n(), `1.0~1.5w` = sum(unit_price_type == "1.0~1.5w"), `1.5~2.0w` = sum(unit_price_type == "1.5~2.0w"), `2.0~2.25w` = sum(unit_price_type == "2.0~2.25w"),`2.25~2.5w` = sum(unit_price_type == "2.25~2.5w"), `2.5~2.75w` = sum(unit_price_type == "2.5~2.75w"), `2.5~2.75w` = sum(unit_price_type == "2.5~2.75w"), `2.75~3.0w` = sum(unit_price_type == "2.75~3.0w"), `3.0w+` = sum(unit_price_type == "3.0w+"))  %>% arrange(desc(数量)) %>% kable(.,format = 'markdown',row.names = FALSE, align = "c", longtable = TRUE) 
```
]
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 区域分布
#### 区域总价分段统计
.table1[
```{r total_price_type, echo=FALSE, warning=FALSE}
df_loupan %>% filter(!is.na(T_price)) %>% mutate(T_price = as.numeric(str_replace_all(T_price, "\\s","")))  %>% mutate(T_price_type = cut(T_price, breaks = c(39,100,150, 200, 230,270, 300, 9000), labels = c("39~100w","100~150w","150~200w","200~230w","230~270w","270~300w","300w+"))) %>% group_by(District) %>% summarise(数量 = n(), `39~100w` = sum(T_price_type == "39~100w"), `100~150w` = sum(T_price_type == "100~150w"), `150~200w` = sum(T_price_type == "150~200w"),`200~230w` = sum(T_price_type == "200~230w"), `230~270w` = sum(T_price_type == "230~270w"),`270~300w` = sum(T_price_type == "270~300w"), `300w+` = sum(T_price_type == "300w+"))  %>% arrange(desc(数量)) %>% kable(.,format = 'html',row.names = FALSE, align = "c", longtable = TRUE) 
```
]

---

class: inverse, middle, center

## 房价基本分析

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 房价分析
#### 房源类型单价统计
.center[
```{r box_type, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 7.5, fig.height=5}
library(Hmisc)
trellis.par.set("add.text", list(cex = 3))
df_loupan %>%  filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% bwplot(Type ~ as.numeric(Unit_price), data = ., panel = panel.bpplot, xlim =c(10000 ,80000) , xlab ='House Price', scale = list(cex = c(1.2,2)), cex.n = 1.2)
```
]
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 房价分析
#### 房源状态单价统计
.center[
```{r box_status, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 7.5, fig.height=5}
library(Hmisc)
trellis.par.set("add.text", list(col = "red"))
df_loupan %>%  filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% bwplot(Status ~ as.numeric(Unit_price), data = ., panel = panel.bpplot, xlim =c(10000 ,80000) , xlab ='House Price', scale = list(cex = c(1.2,2)), cex.n = 1.2)
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
### 房价分析
#### 房源状态单价统计
.plot_pos[
```{r box_district, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 6, fig.height=7.5}
library(Hmisc)
trellis.par.set("add.text", list(cex = 3))
df_loupan %>%  filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% bwplot(District ~ as.numeric(Unit_price), data = ., panel = panel.bpplot, xlim =c(10000 ,80000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1)
```
]


---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
.plot_pos[
```{r box_district_total, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 6, fig.height=7.5}
df_loupan %>%  filter(!is.na(T_price))  %>% mutate(T_price = as.numeric(T_price))  %>% filter(T_price > 10 & T_price < 1000) %>% filter(Type == "住宅") %>% bwplot(District ~ as.numeric(T_price), data = ., panel = panel.bpplot, xlim =c(10 ,1000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1)
```
]
---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
.center[
```{r box_type_total, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 6, fig.height=7.5}
df_loupan %>%  filter(!is.na(T_price))  %>% mutate(T_price = as.numeric(T_price))  %>% filter(T_price > 10) %>% bwplot(Type ~ as.numeric(T_price), data = ., panel = panel.bpplot, xlim =c(10 ,3000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1)
```
]

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
.center[
```{r box_status_total, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 6, fig.height=7.5}
df_loupan %>%  filter(!is.na(T_price))  %>% mutate(T_price = as.numeric(T_price))  %>% filter(T_price > 10)  %>% filter(Type == "住宅")  %>% bwplot(Status ~ as.numeric(T_price), data = ., panel = panel.bpplot, xlim =c(10 ,3000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1)
```
]

---

background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
## 标签
```{r tag, echo=FALSE}
DT::datatable(
  df_loupan$Tags %>% str_split(" ") %>% unlist() %>% table(dnn = "Tag") %>% as.data.frame() %>% arrange(desc(Freq)),
  fillContainer = FALSE, options = list(pageLength = 8)
)


```


---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
#### **标签分析**
**地铁沿线**、*贴心物业*、**环线房**、**品牌房企**和*公交直达*为考虑最多标签！
.plot_pos1[
```{r tag_bwplot, echo=FALSE}
tag_names = df_loupan$Tags %>% str_split(" ") %>% unlist() %>% table(dnn = "Tag") %>% as.data.frame() %>% arrange(desc(Freq)) %>% slice(1:14) %>% pull(Tag) %>% as.character()
lapply(tag_names, function(x) filter(df_loupan, str_detect(Tags, x)) %>% filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% select(District, Status, Type, Unit_price) %>% mutate(tag = x))  %>% bind_rows() %>% filter(Type == "住宅") %>% bwplot(tag  ~ Unit_price,data = ., panel = panel.bpplot, xlim =c(10000 ,50000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1) 
```
]


---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
#### **标签分析** - 江宁区
.pull-left[
## 售罄
```{r tag_bwplot_saled, echo=FALSE}
tag_names = df_loupan$Tags %>% str_split(" ") %>% unlist() %>% table(dnn = "Tag") %>% as.data.frame() %>% arrange(desc(Freq)) %>% slice(1:14) %>% pull(Tag) %>% as.character()
lapply(tag_names, function(x) filter(df_loupan, str_detect(Tags, x)) %>% filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% select(District, Status, Type, Unit_price) %>% mutate(tag = x))  %>% bind_rows() %>% filter(Type == "住宅" & Status == "售罄" & District == "江宁") %>% bwplot(tag  ~ Unit_price,data = ., panel = panel.bpplot, xlim =c(10000 ,50000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1) 
```
]
.pull-right[
## 在售
```{r tag_bwplot_saling, echo=FALSE}
tag_names = df_loupan$Tags %>% str_split(" ") %>% unlist() %>% table(dnn = "Tag") %>% as.data.frame() %>% arrange(desc(Freq)) %>% slice(1:14) %>% pull(Tag) %>% as.character()
lapply(tag_names, function(x) filter(df_loupan, str_detect(Tags, x)) %>% filter(!is.na(Unit_price))  %>% mutate(Unit_price = as.numeric(Unit_price))  %>% filter(Unit_price > 10000) %>% select(District, Status, Type, Unit_price) %>% mutate(tag = x))  %>% bind_rows() %>% filter(Type == "住宅" & Status == "在售" & District == "江宁") %>% bwplot(tag  ~ Unit_price,data = ., panel = panel.bpplot, xlim =c(10000 ,50000) , xlab ='House Price', scale = list(cex = c(1.2,1)),box.ratio = 0.5, cex.n = 1.1) 
```
]


---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%

---
background-image: url("https://img1.gtimg.com/comic/pics/hv1/31/228/1840/119704171.jpg")
background-size: 150px
background-position: 93% 3%
 

---

class: center, middle

## **谢谢老板!**

该项目所有资料记录在[**github**](https://github.com/w4356y/House_price)
